<!DOCTYPE html>
<html>
	<head>
		<!-- COMMON -->
		<script src="/js-modules/modules/00-common/render-polygons-as-path-svg.js"></script>
		<script src="/js-modules/modules/00-common/get-bounding-points.js"></script>
		<!-- SILHOUETTE - could try to figure out how to include as a module? -->
		<script src="/js-modules/modules/02-silhouette/image.min.js"></script>
		<!-- TRACE - could try to figure out how to include as a module? -->
		<script src="/js-modules/modules/03-trace/imagetracer_v1.2.6.js"></script>
		<!-- TRACE CLEANUP -->
		<script src="/js-modules/modules/03-trace/flatten-svg/path-data-polyfill.js"></script>
		<!-- TODO: the TRACE CLEANUP scripts below this comment could be modules -->
		<script src="/js-modules/modules/03-trace/flatten-svg/svg-to-paths.js"></script>
		<!-- OFFSET -->
		<script src="/js-modules/modules/04-offset/browser.maker.js"></script>
		<script src="/js-modules/modules/04-offset/svg-path-outline.js"></script>
		<script src="/js-modules/modules/04-offset/apply-offset.js"></script>
		<script src="/js-modules/modules/04-offset/flatten-svg-to-paths.js"></script>
		<script src="/js-modules/modules/04-offset/parse-svg-viewbox.js"></script>
		<!-- ARRANGE -->
		<script src="/js-modules/modules/05-arrange/create-circular-polygon.js"></script>
		<!-- main module -->
		<script type="module" src="/js-modules/main.js"></script>
		<!-- main execution -->
		<script>
			/**
			 * TODO: allow runAll() to start from specific step.
			 * Eg, when adjusting `offset`, should re-run from `applyOffset()`
			 * onwards, everything before is already done.
			 */
			async function runAll() {
				await silhouetteExecute("raw-image", "processed-image");
				const result = await traceExecute("processed-image", "trace-svg");

				const svgSourceContainer = document.getElementById("trace-svg");
				const svgSource = svgSourceContainer.querySelector("svg");
				const polygons_offset = applyOffset("trace-svg", "offset-svg");
				const polygons_translated = arrangeForUnion(
					polygons_offset,
					document.getElementById("arrange-container")
				);
			}

			async function resetAndRunAll() {
				silhouetteResetSettings();
				await runAll();
			}
		</script>
	</head>
	<body onload="resetAndRunAll()">
		<!--  -->
		<!--  -->
		<!--  -->
		<h2>UPLOAD</h2>
		<!--  -->
		<!--  -->
		<!--  -->

		<p>
			<input
				type="file"
				id="image-input"
				accept="image/png, image/jpeg"
				onchange="onImageSelection(this, 'raw-image', resetAndRunAll)"
			/>
		</p>

		<!--  -->
		<!--  -->
		<!--  -->
		<h2>SILHOUETTE</h2>
		<!--  -->
		<!--  -->
		<!--  -->

		<div style="display: flex; align-items: center">
			<img id="raw-image" src="/sample-char-art-00.jpeg" />
			<img id="processed-image" />
		</div>

		<h3>Silhouette tweaks</h3>
		<p>
			Threshold (100 means auto)
			<input id="threshold" type="number" min="0" max="100" value="100" />
		</p>
		<p>
			Radius
			<input id="radius" type="number" min="1" max="100" value="5" />
		</p>
		<p>
			<button onClick="runAll()">Apply silhouette tweaks</button>
		</p>

		<!--  -->
		<!--  -->
		<!--  -->
		<h2>TRACE</h2>
		<!--  -->
		<!--  -->
		<!--  -->

		<div id="trace-svg"></div>
		<h3>Trace tweaks</h3>
		<p>Path omit: <input id="pathomit" type="number" min="0" value="30" /></p>
		<p>
			<button onClick="runAll()">Apply trace tweaks</button>
		</p>

		<!--  -->
		<!--  -->
		<!--  -->
		<h2>OFFSET</h2>
		<!--  -->
		<!--  -->
		<!--  -->

		<div id="offset-svg"></div>
		<h3>Trace tweaks</h3>
		<p>
			Offset:
			<input id="offset" type="number" min="0" max="100" value="30" />
		</p>
		<button onClick="runAll()">Apply offset tweaks</button>

		<!--  -->
		<!--  -->
		<!--  -->
		<h2 style="color: magenta">ARRANGE</h2>
		<!--  -->
		<!--  -->
		<!--  -->

		<div id="arrange-container"></div>
		<h3>Arrangement tweaks</h3>
		<p>
			Height in mm (1 inch ~= 25 mm)
			<input id="heightMm" type="number" min="5" max="100" value="35" />
		</p>
		<p>
			X offset in pixels ("center")
			<input id="arrangeOffsetX" type="number" min="-100" max="100" value="0" />
		</p>
		<p>
			Y offset in pixels ("float")
			<!-- TODO: max should be based on "base size". For now, have done
			     base size (72) divided by 4 -->
			<input id="arrangeOffsetY" type="number" min="0" max="18" value="0" />
		</p>
		<button onClick="runAll()">Apply arrangement tweaks</button>

		<!--  -->
		<!--  -->
		<!--  -->
		<h2 style="color: magenta">UNION</h2>
		<!--  -->
		<!--  -->
		<!--  -->
		<div id="union-container"></div>
		<h3>Union tweaks</h3>
		<ul style="color: magenta">
			<li>TODO: start implementing union step</li>
		</ul>
		<button onClick="runAll()">Apply union tweaks</button>
	</body>
</html>
