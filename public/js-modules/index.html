<!DOCTYPE html>
<html>
	<head>
		<!-- COMMON -->
		<script src="/js-modules/modules/00-common/render-polygons-as-path-svg.js"></script>
		<!-- SILHOUETTE - could try to figure out how to include as a module? -->
		<script src="/js-modules/modules/02-silhouette/image.min.js"></script>
		<!-- TRACE - could try to figure out how to include as a module? -->
		<script src="/js-modules/modules/03-trace/imagetracer_v1.2.6.js"></script>
		<!-- TRACE CLEANUP -->
		<script src="/js-modules/modules/03-trace/flatten-svg/path-data-polyfill.js"></script>
		<!-- TODO: the TRACE CLEANUP scripts below this comment could be modules -->
		<script src="/js-modules/modules/03-trace/flatten-svg/svg-to-paths.js"></script>
		<!-- OFFSET -->
		<script src="/js-modules/modules/04-offset/browser.maker.js"></script>
		<script src="/js-modules/modules/04-offset/svg-path-outline.js"></script>
		<script src="/js-modules/modules/04-offset/apply-offset.js"></script>
		<script src="/js-modules/modules/04-offset/flatten-svg-to-paths.js"></script>
		<script src="/js-modules/modules/04-offset/parse-svg-viewbox.js"></script>
		<!-- main module -->
		<script type="module" src="/js-modules/main.js"></script>
		<!-- main execution -->
		<script>
			/**
			 * TODO: allow runAll() to start from specific step.
			 * Eg, when adjusting `offset`, should re-run from `applyOffset()`
			 * onwards, everything before is already done.
			 */
			async function runAll() {
				await silhouetteExecute("raw-image", "processed-image");
				const result = await traceExecute("processed-image", "trace-svg");

				const svgSourceContainer = document.getElementById("trace-svg");
				const svgSource = svgSourceContainer.querySelector("svg");
				applyOffset("trace-svg", "offset-svg");
			}

			async function resetAndRunAll() {
				silhouetteResetSettings();
				await runAll();
			}
		</script>
	</head>
	<body onload="resetAndRunAll()">
		<!--  -->
		<!--  -->
		<!--  -->
		<h2>UPLOAD</h2>
		<!--  -->
		<!--  -->
		<!--  -->

		<p>
			<input
				type="file"
				id="image-input"
				accept="image/png, image/jpeg"
				onchange="onImageSelection(this, 'raw-image', resetAndRunAll)"
			/>
		</p>

		<!--  -->
		<!--  -->
		<!--  -->
		<h2>SILHOUETTE</h2>
		<!--  -->
		<!--  -->
		<!--  -->

		<div style="display: flex; align-items: center">
			<img id="raw-image" src="/sample-char-art-00.jpeg" />
			<img id="processed-image" />
		</div>

		<h3>Silhouette tweaks</h3>
		<p>
			Threshold (100 means auto)
			<input id="threshold" type="number" min="0" max="100" value="100" />
		</p>
		<p>
			Radius
			<input id="radius" type="number" min="1" max="100" value="5" />
		</p>
		<p>
			<button onClick="runAll()">Apply silhouette tweaks</button>
		</p>

		<!--  -->
		<!--  -->
		<!--  -->
		<h2>TRACE</h2>
		<!--  -->
		<!--  -->
		<!--  -->

		<div id="trace-svg"></div>
		<h3>Trace tweaks</h3>
		<p>Path omit: <input id="pathomit" type="number" min="0" value="30" /></p>
		<p>
			<button onClick="runAll()">Apply trace tweaks</button>
		</p>

		<!--  -->
		<!--  -->
		<!--  -->
		<h2>OFFSET</h2>
		<!--  -->
		<!--  -->
		<!--  -->

		<div id="offset-svg"></div>
		<h3>Trace tweaks</h3>
		<p>
			Offset:
			<input id="offset" type="number" min="0" max="100" value="30" />
		</p>
		<button onClick="runAll()">Apply offset tweaks</button>
	</body>
</html>
