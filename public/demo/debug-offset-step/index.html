<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Debug Offset Step</title>
		<script src="/demo/debug-offset-step/global/pathseg-polyfill.js"></script>
		<!-- https://sourceforge.net/p/jsclipper/wiki/documentation/ -->
		<script src="/demo/debug-offset-step/global/clipper.js"></script>
		<script src="/demo/debug-offset-step/post-trace-fixtures/example-data.js"></script>
		<script type="module">
			import { regionsFromPathDataString } from "/demo/debug-offset-step/modules/regions-from-path-data-string.js";
			import { svgNodeFromPolygons } from "/demo/debug-offset-step/modules/svg-node-from-polygons.js";
			import { applyOffsetToRegions } from "/demo/debug-offset-step/modules/apply-offset-to-regions.js";
			import { simplifyRegions } from "/demo/debug-offset-step/modules/simplify-regions.js";
			import { cleanRegions } from "/demo/debug-offset-step/modules/clean-regions.js";

			const OFFSET_AMOUNT = 12;

			/**
			 * Puff out the viewBox of each example a bit, so we have offset space
			 */
			const examplesPrepared = EXAMPLES.map((example) => {
				const { pathData, viewBox: rawViewBox } = example;
				const extraPadding = OFFSET_AMOUNT * 2;
				const viewBox = [
					rawViewBox[0] - extraPadding,
					rawViewBox[1] - extraPadding,
					rawViewBox[2] + extraPadding * 2,
					rawViewBox[3] + extraPadding * 2,
				];
				return { pathData, viewBox };
			});

			/**
			 * Render each of the examples
			 */
			for (const { pathData, viewBox } of examplesPrepared) {
				const regions = regionsFromPathDataString(pathData);
				/**
				 * Render a "before" element, for comparison
				 */
				const beforeSvgNode = svgNodeFromPolygons([{ regions }], viewBox, {
					showDebug: true,
					debugColor1: "rgba(255,0,255,0.3)",
					debugColor2: "rgba(255,0,255,0.8)",
				});
				document.body.append(beforeSvgNode);

				/**
				 * Ensure the region has no self-intersections, render the result
				 */
				const regionsCleaned = cleanRegions(regions, 0.5);
				const regionsSimplified = simplifyRegions(regionsCleaned);
				const simplifiedRegionNode = svgNodeFromPolygons(
					[{ regions: regionsSimplified }],
					viewBox,
					{
						showDebug: true,
						debugColor1: "rgba(128,0,255,0.3)",
						debugColor2: "rgba(128,0,255,0.8)",
					}
				);
				document.body.append(simplifiedRegionNode);

				/**
				 * Apply the offset to the simplified regions, and render the result
				 */
				const rawOffsetRegions = applyOffsetToRegions(
					regionsSimplified,
					OFFSET_AMOUNT
				);
				/**
				 * Clean the offset regions, and render the result
				 *
				 * TODO: could add user-facing control over the clean threshold.
				 * Alternately... should maybe keep the "clean" threshold pretty low,
				 * and later add a true path smoothing step... see NOTES.md for more,
				 * I think the latest is I might want to explore using:
				 * https://mourner.github.io/simplify-js/
				 */
				const offsetRegions = cleanRegions(rawOffsetRegions, 0.5);
				// const offsetRegions = rawOffsetRegions;
				const offsetPolygon = { regions: offsetRegions };
				const offsetNode = svgNodeFromPolygons([offsetPolygon], viewBox, {
					showDebug: true,
					debugColor1: "rgba(0,128,255,0.3)",
					debugColor2: "rgba(0,128,255,0.8)",
				});
				document.body.append(offsetNode);
				// Create a divider before the next example
				document.body.append(document.createElement("hr"));
			}
		</script>
	</head>
	<body></body>
</html>
