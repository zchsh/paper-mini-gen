<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Debug Offset Step</title>
		<script src="/demo/debug-offset-step/global/pathseg-polyfill.js"></script>
		<!-- https://sourceforge.net/p/jsclipper/wiki/documentation/ -->
		<script src="/demo/debug-offset-step/global/clipper.js"></script>
		<script src="/demo/debug-offset-step/post-trace-fixtures/example-data.js"></script>
		<script type="module">
			import { regionsFromPathDataString } from "/demo/debug-offset-step/modules/regions-from-path-data-string.js";
			import { svgNodeFromPolygons } from "/demo/debug-offset-step/modules/svg-node-from-polygons.js";

			/**
			 * TODO: write description
			 */
			function simplifyRegions(regions) {
				const polygonsClipper = regions.map((region) => {
					return region.map(([X, Y]) => ({ X, Y }));
				});
				const polygonsClipperSimplified = ClipperLib.Clipper.SimplifyPolygons(
					polygonsClipper,
					ClipperLib.PolyFillType.pftNonZero
				);
				const polygonsSimplified = polygonsClipperSimplified.map((region) => {
					return region.map(({ X, Y }) => [X, Y]);
				});
				return polygonsSimplified;
			}

			// Render each of the examples
			for (const { pathData, viewBox } of EXAMPLES) {
				const regions = regionsFromPathDataString(pathData);
				// Render a "before" element, for comparison
				const beforeSvgNode = svgNodeFromPolygons([{ regions }], viewBox, {
					showDebug: true,
					debugColor1: "rgba(255,0,255,0.3)",
					debugColor2: "rgba(255,0,255,0.8)",
				});
				document.body.append(beforeSvgNode);
				// Ensure the region has no self-intersections, using SimplifyPolygon()
				const regionsSimplified = simplifyRegions(regions);
				const simplifiedRegionNode = svgNodeFromPolygons(
					[{ regions: regionsSimplified }],
					viewBox,
					{
						showDebug: true,
						debugColor1: "rgba(255,0,255,0.3)",
						debugColor2: "rgba(0,0,255,0.8)",
					}
				);
				document.body.append(simplifiedRegionNode);
				/**
				 * TODO: offset the simplified shape, and render that out
				 */
			}
		</script>
	</head>
	<body></body>
</html>
