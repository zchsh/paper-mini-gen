<!DOCTYPE html>
<html>
	<head>
		<!-- https://www.lactame.com/lib/image-js/0.21.2/image.min.js -->
		<!-- IMAGE UPLOAD  -->
		<script src="/demo-image-js/on-image-selection.js"></script>
		<script src="/demo-image-js/image.min.js"></script>
		<script src="/demo-image-js/get-input-as-int.js"></script>
		<script src="/demo-image-js/apply-threshold.js"></script>
		<script src="/demo-image-js/get-fallback-threshold.js"></script>
		<script>
			function resetSettings() {
				document.getElementById("threshold").value = 100;
				document.getElementById("radius").value = 5;
			}
		</script>
		<script>
			async function processImage() {
				// Load the original raw image from a source element
				const imgElem = document.getElementById("raw-image");
				// Gather optional settings
				const thresholdInput = getInputAsInt("threshold");
				const useAuto = thresholdInput === 100;
				/**
				 * TODO: for transparent images,
				 * apply a white background before processing.
				 * This should happen before auto-threshold, and before
				 * applyThreshold as well.
				 *
				 * Maybe helpful link:
				 * https://github.com/image-js/image-js/issues/485#issuecomment-508472868
				 */
				let image = await IJS.Image.load(imgElem.src);
				const thresholdAuto = await getFallbackThreshold(image);
				const threshold = useAuto ? thresholdAuto : thresholdInput;
				const radius = getInputAsInt("radius");
				// Process the image
				const processedSrc = await applyThreshold(
					image,
					threshold / 100.0,
					radius
				);
				// Load the image into a destination element
				document.getElementById("processed-image").src = processedSrc;
			}
		</script>
	</head>
	<body onload="resetSettings(); processImage()">
		<!--  -->
		<!--  -->
		<!--  -->
		<h2>IMAGE PROCESSING</h2>
		<!--  -->
		<!--  -->
		<!--  -->

		<p>
			<input
				type="file"
				id="image-input"
				accept="image/png, image/jpeg"
				onchange="onImageSelection(this, 'raw-image', () => {
					processImage()
				})"
			/>
		</p>
		<h3>Tweaks</h3>
		<p>
			Threshold (100 means auto)
			<input id="threshold" type="number" min="0" max="100" value="100" />
		</p>
		<p>
			Radius
			<input id="radius" type="number" min="1" max="100" value="5" />
		</p>
		<p><button onClick="processImage()">Apply tweaks</button></p>

		<div style="display: flex; align-items: center">
			<img id="raw-image" src="/sample-char-art-01-small.jpeg" />
			<img id="processed-image" />
		</div>
	</body>
</html>
